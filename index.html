<html>
    <head>
        <script src="https://unpkg.com/react@16/umd/react.production.min.js" crossorigin></script>
        <script src="https://unpkg.com/react-dom@16/umd/react-dom.production.min.js" crossorigin></script>
        <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/react-router-dom/5.1.2/react-router-dom.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.19.0/axios.js"></script>
        <!-- <link rel="stylesheet" href="/main.css"> -->
        <style>
            .container {
            width: 300px;
            height: 200px;
            background-color: lightgray;
            border: 1px solid black;
            border-radius: 10px;
            box-sizing: border-box;
            }

            .title {
            text-align: center;
            }

            .portrait-crop {
            display: inline-block;
            height: 70px;
            width: 100%;
            overflow: hidden;
            }

            .portrait-crop img{
                width: 100%;
                margin:-21.875% 0;
            }

            .third {
            text-align: center;
            }
        </style>
    </head>
    <body>
        <div id="root"></div>
        <script type="text/babel">
            const { Component } = React;
            const { render } = ReactDOM;
            const { HashRouter, Route, Switch, Link } = ReactRouterDOM;
            const root = document.getElementById('root');

            class Form extends Component{
                constructor(){
                    super();
                    this.state = {
                    student: {}
                    
                }
                this.handleSubmit = this.handleSubmit.bind(this);
            }
                async handleSubmit(){
                    await this.props.create(this.state)
                }
                render(){
                    const { student, schools } = this.state;
                    const { handleSubmit } = this;
                    return (
                    <form onSubmit={handleSubmit}>
                        First name: <input value={ firstName } onChange={(ev)=> this.setState({ firstName: ev.target.value})} />
                        Last name: <input value={ lastName } onChange={(ev)=> this.setState({ lastName: ev.target.value})} />
                        Email: <input value={ email } onChange={(ev)=> this.setState({ email: ev.target.value})} />
                        GPA<input value={ GPA } onChange={(ev)=> this.setState({ GPA: ev.target.value})} />
                        <select className='schoolImage' onChange={(ev)=>this.setState({schoolId: ev.target.value})}>
                            {schools.map(school => <option key={school.id} value={school.id}>{school.name}</option>)}
                            </select>
                        <button type='submit'>Save</button>
                    </form>
                    );
                }
            }


            const Nav = ({ schools, students, path }) => {
                return(
                <nav>
                    <Link to='/schools'>School</Link>
                    <Link to='/students'>Student</Link>
                </nav>
                )
            };

            const Schools = ({ schools, students }) => {
                /*
                const schoolStudents = schools.map(school => {
                   return {...school, student: students.filter(student => student.schoolId === school.id)}
                })
                */
                return (
                    <div>
                        {schools.map(school => <Link to={`/schools/${school.id}`}><div className='container'>
                                <div className='title'>
                                <h3>{school.name}</h3>
                                </div>
                                <div className='image portrait-crop'>
                                        <img src={school.imageUrl}/>
                                </div>
                                <div>
                                <h3 className='third'>{school.students.length}</h3>
                                </div>
                            </div></Link>)}
                    </div>         
                    
                )
            };

            const School = (props) => {
                const id = props.match.params.id;
                const school = props.schools.find(school => school.id === id);
                console.log(props)
                 return (
                    <div>
                        <h2>{school.name}</h2>
                        <ul>
                            {
                                school.students.map(student => <li><div className='container'>
                                <div className='title'>
                                <h3>{student.firstName} {student.lastName}</h3>
                                </div>
                                <div className='image portrait-crop'>
                                        <img src={school.imageUrl}/>
                                </div>
                                <div>
                                <h3 className='third'>GPA {student.GPA}</h3>
                                </div>
                            </div></li>)
                            }
                        </ul>
                    </div>
                 )
            }

            const Student = () => {
                return (
                    <h1>Student</h1>
                )
            }

            class App extends Component{
                constructor(){
                    super();
                    this.state = {
                        students: [],
                        schools: []
                    }
                }
                async componentDidMount(){
                    const responses = await Promise.all([axios.get('/api/students'), axios.get('/api/schools')])
                    this.setState({ students: responses[0].data, schools: responses[1].data })
                }
                render(){
                    const { students, schools } = this.state
                    return(
                        <HashRouter>
                            <Route render={ (props)=> <Nav path={ props.location.pathname} schools={schools} students={students}   /> } />
                            <Form schools={ schools } students={students}/>
                            <Switch>
                                <Route exact path='/schools' render={() => <Schools schools={schools} students={students}/>} />
                                <Route path='/schools/:id' render={(props) => <School schools={schools} students={students} {...props} />} />
                                <Route path='/students' component= {Student}/>
                            </Switch>
                        </HashRouter>
                    )
                }
            }
            render(<App />, root);

        </script>
        
    </body>
</html>